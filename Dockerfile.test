FROM centos:7

COPY epel.repo /etc/yum.repos.d/
RUN yum -y install --nogpgcheck epel-release && \
    rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-* && \
    yum -y install make libgit2-glib tito pylint  \
                    python-nose python-mako python-flask \
                    python-coverage libselinux-python sudo \
                    pykickstart python2-pytoml python-sphinx \
                    python2-mock python-semantic_version \
                    anaconda-tui python-gevent beakerlib && \
    yum clean all && \
    rm -rf /var/cache/yum && \
    useradd weldr

RUN mkdir /lorax
COPY . /lorax
# remove byte-compiled files to avoid issues between Python 2/3
# this can happen when you switch between rhel7 and master branches
RUN find /lorax -name "*.pyc" -exec rm -f {} \;

WORKDIR /lorax
RUN make test
